# CLAUDE.md — Beer List Plugin

## Project Overview

WordPress plugin for managing and displaying a brewery's beverage catalog. Registers a custom "Beverage" post type with associated taxonomies and meta fields, and provides a Gutenberg block for rendering a filterable beverage grid on the frontend.

## Tech Stack

- **Backend:** PHP (WordPress plugin APIs)
- **Frontend (editor):** React via `@wordpress/components` and `@wordpress/block-editor`
- **Frontend (public):** Server-side PHP rendering (`render.php`) + vanilla JavaScript (`view.js`)
- **Build:** Webpack via `@wordpress/scripts`
- **Local dev environment:** `@wordpress/env` (Docker-based WordPress)

## Directory Structure

```
beer-list.php              # Plugin entry point — defines constants, loads includes
includes/
  post-types.php           # Registers `beverage` custom post type
  taxonomies.php           # Registers 4 taxonomies (type, style, availability, serving_format)
  meta-fields.php          # Registers post meta (ABV, IBU, price, tasting notes) + meta box
  blocks.php               # Registers the Gutenberg block + enqueues view script
src/blocks/beverage-list/
  block.json               # Block metadata and attributes
  index.js                 # Block registration entry point
  edit.js                  # Editor React component (InspectorControls + preview grid)
  view.js                  # Frontend filtering JS (filter buttons show/hide items)
  render.php               # Server-side block rendering template
  style.css                # Shared styles (editor + frontend)
  editor.css               # Editor-only styles
build/                     # Compiled assets (gitignored, generated by `npm run build`)
```

## Commands

```sh
npm run build        # Compile JS/CSS for production (output to build/)
npm run dev          # Start webpack dev server with hot reload
npm start            # Start local WordPress environment (Docker required)
npm stop             # Stop local WordPress environment
npm test             # Not configured yet — exits with error
```

## Data Model

### Custom Post Type
- **`beverage`** — title, editor, thumbnail support; archive at `/beverages/`; REST-enabled

### Taxonomies (all REST-enabled)
| Taxonomy | Hierarchical | Purpose |
|---|---|---|
| `beverage_type` | Yes | Broad categories (Beer, Cider, etc.) |
| `beverage_style` | Yes | Specific styles (IPA, Stout, Pilsner) |
| `beverage_availability` | No (tags) | When available (seasonal, year-round) |
| `serving_format` | No (tags) | How served (can, bottle, tap) |

### Post Meta (prefixed with `_beverage_`)
| Key | Type | Purpose |
|---|---|---|
| `_beverage_abv` | number | Alcohol by Volume % |
| `_beverage_ibu` | number | International Bitterness Units |
| `_beverage_price` | string | Price display text |
| `_beverage_tasting_notes` | string | Flavor/tasting description |

## Gutenberg Block

**Name:** `beer-list/beverage-list`

**Attributes:**
- `postsPerPage` (number, default 12) — how many beverages to display
- `beverageType` (string, default "") — filter to a specific type term ID
- `showFilters` (boolean, default true) — show/hide the filter bar

**Rendering:** Server-side via `render.php` (not React on the frontend). The editor shows a live preview via the `edit.js` React component that fetches data from the REST API.

## Code Conventions

### PHP
- Text domain: `beer-list` — all translatable strings use `__()` / `esc_html_e()` with this domain
- Function prefix: `beer_list_` for all global functions
- Constant prefix: `BEER_LIST_` (e.g., `BEER_LIST_PLUGIN_DIR`)
- ABSPATH guard at the top of every PHP file: `if ( ! defined( 'ABSPATH' ) ) { exit; }`
- WordPress coding standards: tabs for indentation, spaces inside parentheses (`array( 'key' => 'value' )`)
- Nonce verification and capability checks on all save operations
- Output escaping: `esc_html()`, `esc_attr()`, `esc_textarea()` everywhere

### JavaScript / React
- ES6 module syntax with `@wordpress/*` package imports
- Block registration pattern: `block.json` metadata + `index.js` entry + `edit.js` component
- Data fetching via `useSelect` from `@wordpress/data` with the core data store
- No TypeScript — plain JavaScript
- WordPress coding standards: tabs for indentation, spaces inside braces/parentheses

### CSS
- Vanilla CSS (no preprocessor)
- BEM-like naming: `.beverage-list__item`, `.beverage-list__filter.is-active`
- CSS Grid for responsive layouts (`auto-fill, minmax(260px, 1fr)`)
- Separate files for shared styles (`style.css`) and editor-only styles (`editor.css`)

## Build Configuration

Webpack extends `@wordpress/scripts` defaults with two custom entry points:
- `blocks/beverage-list/index` — editor bundle
- `blocks/beverage-list/view` — frontend filtering script

Output goes to `/build`. The `build/` directory is gitignored and must be regenerated after cloning.

## Development Setup

1. `npm install` — install dependencies
2. `npm start` — start Docker-based WordPress (requires Docker)
3. `npm run dev` — start webpack watcher for JS/CSS changes
4. Access WordPress at `http://localhost:8888` (default wp-env port)
5. Activate the "Beer List" plugin in WP Admin > Plugins

## Important Notes

- No test suite configured yet — `npm test` will exit with an error
- No CI/CD pipelines — no `.github/workflows` directory
- No `.env` files — all config is via WordPress constants and `.wp-env.json`
- Debug flags are enabled in `.wp-env.json` (`WP_DEBUG`, `WP_DEBUG_LOG`, `SCRIPT_DEBUG`)
- The REST API must be available for the editor block to function (all custom types/meta have `show_in_rest: true`)
